{%- comment -%}
  Shopify Markets Language Selector
  Uses Shopify's native localization API for language switching
  Replaces the old hard-coded language system
{%- endcomment -%}

{%- if localization.available_languages.size > 1 -%}
<div class="halo-language markets-language">
  <link rel="stylesheet" href="{{ 'disclosure.css' | asset_url }}" media="all" onload="this.media='all'">
  <noscript>{{ 'disclosure.css' | asset_url | stylesheet_tag }}</noscript>
  
  <noscript>
    {%- form 'localization', id: 'HeaderLanguageFormNoScript', class: 'localization-form' -%}
      <div class="localization-form__select">
        <h2 class="visually-hidden" id="HeaderLanguageLabelNoScript">{{ 'localization.language_label' | t }}</h2>
        <select class="localization-selector link" name="locale_code" aria-labelledby="HeaderLanguageLabelNoScript">
          {%- for language in localization.available_languages -%}
            <option 
              value="{{ language.iso_code }}" 
              lang="{{ language.iso_code }}" 
              {%- if language.iso_code == localization.language.iso_code %} selected{% endif %}
            >
              {{ language.endonym_name | capitalize }}
            </option>
          {%- endfor -%}
        </select>
      </div>
      <button class="button button--tertiary">{{ 'localization.update_language' | t }}</button>
    {%- endform -%}
  </noscript>
  
  <localization-form>
    {%- form 'localization', id: 'HeaderLanguageForm', class: 'localization-form' -%}
      <div class="no-js-hidden">
        <div class="disclosure">
          <p class="title text-left" id="HeaderLanguageLabel">{{ 'localization.language_label' | t }}</p>
          <ul 
            id="HeaderLanguageList" 
            role="list" 
            class="disclosure__list list-unstyled custom-scrollbar d-flex flex-align-center flex-wrap"
          >
            {%- for language in localization.available_languages -%}
              <li class="disclosure__item" tabindex="-1">
                <a 
                  role="link" 
                  aria-disabled="true" 
                  class="link link--text disclosure__link d-flex flex-align-center{% if language.iso_code == localization.language.iso_code %} disclosure__link--active{% endif %} focus-inset" 
                  hreflang="{{ language.iso_code }}" 
                  lang="{{ language.iso_code }}" 
                  {% if language.iso_code == localization.language.iso_code %} aria-current="true" {% endif %} 
                  data-value="{{ language.iso_code }}"
                  aria-label="{{ language.endonym_name }}"
                >
                  <span class="text">{{ language.iso_code | upcase }}</span>
                </a>
              </li>
            {%- endfor -%}
          </ul>
        </div>
        <input type="hidden" name="locale_code" value="{{ localization.language.iso_code }}">
      </div>
    {%- endform -%}
  </localization-form>
</div>

<script src="{{ 'halo-languages.js' | asset_url }}" defer="defer"></script>
{%- endif -%}

